import rasterio
from rasterio.tools.mask import mask
# the polygon GeoJSON geometry
#geoms = [{'type': 'Polygon', 'coordinates': [[(250204.0, 141868.0), (250942.0, 141868.0), (250942.0, 141208.0), (250204.0, 141208.0), (250204.0, 141868.0)]]}]
#geoms = [{"type": "Polygon", "coordinates": [          [            [              -15.875244140625,              15.093339268117337            ],            [              -16.1883544921875,              14.700508321287574            ],            [              -15.545654296875,              14.705821604736103            ],            [              -15.875244140625,              15.093339268117337            ]          ]        ]      }   ]

#geoms = [{ "type": "FeatureCollection","features":[{ "type": "Feature", "geometry": {"type": "Polygon", "coordinates": [[[-16.21495,13.799370000000001],[-16.21678,13.798820000000001],[-16.221790000000002,13.799370000000001],[-16.21678,13.80014],[-16.21495,13.799370000000001],[-16.21495,13.799370000000001]],[[-16.067610000000002,13.91444],[-16.02721,13.896960000000002],[-16.018880000000003,13.891430000000001],[-15.979820000000002,13.875210000000001],[-15.93987,13.86841],[-15.979820000000002,13.86204],[-16.00334,13.86841],[-16.02721,13.883740000000001],[-16.044810000000002,13.891420000000002],[-16.0746,13.90881],[-16.12199,13.903060000000002],[-16.143990000000002,13.91444],[-16.12199,13.933840000000002],[-16.0746,13.918400000000002],[-16.067610000000002,13.914430000000001],[-16.067610000000002,13.91444]],[[-16.165390000000002,13.891430000000001],[-16.16939,13.890120000000001],[-16.18625,13.891430000000001],[-16.16939,13.893170000000001],[-16.165390000000002,13.891430000000001],[-16.165390000000002,13.891430000000001]],[[-15.96066,13.96047],[-15.932440000000001,13.94326],[-15.910750000000002,13.937460000000002],[-15.932440000000001,13.928580000000002],[-15.943740000000002,13.937460000000002],[-15.979830000000002,13.951570000000002],[-16.007820000000002,13.96047],[-15.979830000000002,13.97605],[-15.96066,13.96047],[-15.96066,13.96047]],[[-16.14253,13.983490000000002],[-16.1611,13.96047],[-16.16939,13.95799],[-16.176830000000002,13.96047],[-16.176930000000002,13.983490000000002],[-16.16939,13.99088],[-16.14253,13.983490000000002],[-16.14253,13.983490000000002]],[[-15.925220000000001,14.37475],[-15.928250000000002,14.351730000000002],[-15.932440000000001,14.347830000000002],[-15.960980000000001,14.328710000000001],[-15.932440000000001,14.317710000000002],[-15.912980000000001,14.305700000000002],[-15.932440000000001,14.290180000000001],[-15.940510000000002,14.282680000000001],[-15.93838,14.259660000000002],[-15.932440000000001,14.253250000000001],[-15.92369,14.236640000000001],[-15.886300000000002,14.21362],[-15.89971,14.190600000000002],[-15.92561,14.167580000000001],[-15.911000000000001,14.144560000000002],[-15.892290000000001,14.121540000000001],[-15.932440000000001,14.113800000000001],[-15.94175,14.09852],[-15.932440000000001,14.095250000000002],[-15.885050000000001,14.09026],[-15.837660000000001,14.080100000000002],[-15.803220000000001,14.09852],[-15.790270000000001,14.11068],[-15.742880000000001,14.105770000000001],[-15.730710000000002,14.09852],[-15.742880000000001,14.092590000000001],[-15.771680000000002,14.075510000000001],[-15.790270000000001,14.053730000000002],[-15.837660000000001,14.070910000000001],[-15.85696,14.05249],[-15.837660000000001,14.039320000000002],[-15.81961,14.029470000000002],[-15.837660000000001,14.020470000000001],[-15.885050000000001,14.018120000000001],[-15.916140000000002,14.029470000000002],[-15.932440000000001,14.034410000000001],[-15.93922,14.029470000000002],[-15.979830000000002,14.006590000000001],[-15.9853,14.006450000000001],[-16.02722,14.003150000000002],[-16.038490000000003,13.983430000000002],[-16.06434,13.960410000000001],[-16.07461,13.957530000000002],[-16.082690000000003,13.960410000000001],[-16.11843,13.983430000000002],[-16.121920000000003,14.006450000000001],[-16.122,14.006490000000001],[-16.16939,14.015580000000002],[-16.19281,14.029470000000002],[-16.21678,14.050530000000002],[-16.221590000000003,14.052480000000001],[-16.21678,14.056920000000002],[-16.21195,14.075500000000002],[-16.21678,14.077980000000002],[-16.25918,14.098510000000001],[-16.26417,14.104350000000002],[-16.31156,14.121220000000001],[-16.31212,14.121530000000002],[-16.31156,14.122530000000001],[-16.26417,14.13203],[-16.250020000000003,14.14455],[-16.257350000000002,14.167570000000001],[-16.26418,14.172540000000001],[-16.289710000000003,14.190590000000002],[-16.295160000000003,14.213610000000001],[-16.27652,14.236630000000002],[-16.26418,14.251800000000001],[-16.24738,14.25965],[-16.21679,14.26988],[-16.198800000000002,14.282670000000001],[-16.1694,14.301020000000001],[-16.122010000000003,14.302170000000002],[-16.095560000000003,14.30568],[-16.074620000000003,14.309170000000002],[-16.061600000000002,14.30568],[-16.027230000000003,14.303420000000001],[-16.021050000000002,14.30568],[-16.005300000000002,14.328700000000001],[-16.01755,14.351720000000002],[-16.027240000000003,14.361630000000002],[-16.03548,14.374730000000001],[-16.027240000000003,14.378010000000002],[-15.99172,14.374730000000001],[-15.97985,14.372380000000001],[-15.970960000000002,14.374730000000001],[-15.93246,14.378900000000002],[-15.925250000000002,14.374730000000001],[-15.925220000000001,14.37475]],[[-16.25681,13.983490000000002],[-16.26417,13.980060000000002],[-16.269080000000002,13.983490000000002],[-16.26417,13.993620000000002],[-16.25681,13.983490000000002],[-16.25681,13.983490000000002]],[[-15.78846,13.983490000000002],[-15.790260000000002,13.98263],[-15.792280000000002,13.983490000000002],[-15.790260000000002,13.984620000000001],[-15.78846,13.983490000000002],[-15.78846,13.983490000000002]],[[-16.24978,14.029520000000002],[-16.26416,14.01715],[-16.27945,14.029520000000002],[-16.26416,14.037500000000001],[-16.24978,14.029520000000002],[-16.24978,14.029520000000002]],[[-15.741640000000002,14.029520000000002],[-15.742880000000001,14.028680000000001],[-15.744720000000001,14.029520000000002],[-15.742880000000001,14.030540000000002],[-15.741640000000002,14.029520000000002],[-15.741640000000002,14.029520000000002]],[[-16.397640000000003,14.121580000000002],[-16.40634,14.115240000000002],[-16.41195,14.121580000000002],[-16.40634,14.12597],[-16.397640000000003,14.121580000000002],[-16.397640000000003,14.121580000000002]],[[-15.691440000000002,14.167610000000002],[-15.695480000000002,14.16647],[-15.69818,14.167610000000002],[-15.695480000000002,14.172950000000002],[-15.691440000000002,14.167610000000002],[-15.691440000000002,14.167610000000002]],[[-16.114430000000002,14.37475],[-16.121740000000003,14.351730000000002],[-16.12199,14.351510000000001],[-16.16938,14.342430000000002],[-16.17743,14.351730000000002],[-16.185740000000003,14.37475],[-16.16938,14.37898],[-16.12199,14.38062],[-16.114420000000003,14.37475],[-16.114430000000002,14.37475]],[[-15.970650000000001,14.236640000000001],[-15.97981,14.241560000000002],[-16.0272,14.240340000000002],[-16.04684,14.236640000000001],[-16.07459,14.226820000000002],[-16.10819,14.21362],[-16.12198,14.203940000000001],[-16.12975,14.190600000000002],[-16.147270000000002,14.167580000000001],[-16.14847,14.144560000000002],[-16.12199,14.12315],[-16.116670000000003,14.121550000000001],[-16.12199,14.11954],[-16.16938,14.102070000000001],[-16.1961,14.121550000000001],[-16.21677,14.128280000000002],[-16.22153,14.121550000000001],[-16.21677,14.11414],[-16.17414,14.098540000000002],[-16.16938,14.095260000000001],[-16.15321,14.075520000000001],[-16.13482,14.052500000000002],[-16.12199,14.03949],[-16.10145,14.052500000000002],[-16.0746,14.065570000000001],[-16.039240000000003,14.052500000000002],[-16.02721,14.04747],[-15.979820000000002,14.044060000000002],[-15.972570000000001,14.052510000000002],[-15.977860000000002,14.07553],[-15.979830000000002,14.076020000000002],[-16.02722,14.08538],[-16.050900000000002,14.098550000000001],[-16.03243,14.121570000000002],[-16.02722,14.125070000000001],[-16.014310000000002,14.14459],[-15.995510000000001,14.167610000000002],[-15.998680000000002,14.19063],[-15.979830000000002,14.204460000000001],[-15.959180000000002,14.213640000000002],[-15.970670000000002,14.23666],[-15.970650000000001,14.236640000000001]],[[-16.21517,14.23666],[-16.21678,14.237020000000001],[-16.21753,14.23666],[-16.21678,14.235880000000002],[-16.21517,14.23666],[-16.21517,14.23666]],[[-16.109650000000002,14.259670000000002],[-16.12199,14.26172],[-16.12769,14.259670000000002],[-16.12199,14.246070000000001],[-16.109650000000002,14.259670000000002],[-16.109650000000002,14.259670000000002]],[[-16.06979,14.28269],[-16.0746,14.28326],[-16.07607,14.28269],[-16.0746,14.280310000000002],[-16.06979,14.28269],[-16.06979,14.28269]]]},"properties": {"dataset":"ppp-2015","format":"AAIGrid"}}]}]

#geoms= [{"type": "Polygon","coordinates": [[[-16.21495,13.799370000000001],[-16.21495,13.799370000000001],[-16.21678,13.80014],[-16.221790000000002,13.799370000000001],[-16.21678,13.798820000000001],[-16.21495,13.799370000000001]],[[-16.067610000000002,13.91444],[-16.02721,13.896960000000002],[-16.018880000000003,13.891430000000001],[-15.979820000000002,13.875210000000001],[-15.93987,13.86841],[-15.979820000000002,13.86204],[-16.00334,13.86841],[-16.02721,13.883740000000001],[-16.044810000000002,13.891420000000002],[-16.0746,13.90881],[-16.12199,13.903060000000002],[-16.143990000000002,13.91444],[-16.12199,13.933840000000002],[-16.0746,13.918400000000002],[-16.067610000000002,13.914430000000001],[-16.067610000000002,13.91444]]]}]


import json
import sys

geoms = json.load(sys.stdin)

print json.dumps(geoms['geometries'])
print "-----------"


# load the raster, mask it by the polygon and crop it
with rasterio.open("data/SEN14_A2025_adjv1.TIF") as src:
    out_image, out_transform = mask(src, geoms['geometries'], crop=True)

out_meta = src.meta.copy()

# save the resulting raster
out_meta.update({"driver": "GTiff",
    "height": out_image.shape[1],
    "width": out_image.shape[2],
"transform": out_transform})

with rasterio.open("masked.tif", "w", **out_meta) as dest:
    dest.write(out_image)
